---
- name: Generate SSH keys on master node
  changed_when: false
  vars:
    sshkey: "{{ ansible_env.HOME }}/.ssh/id_rsa"
  shell: |
    ssh-keygen -t rsa -f {{ sshkey }} -N ''
  args:
    creates: "{{ sshkey }}"

- name: SSH Connection Configuration
  changed_when: false
  environment:
    SSHPASS: vagrant
  shell: |
    ssh-keygen -R {{ inventory_hostname }}
    ssh-keyscan {{ inventory_hostname }} >> {{ ansible_env.HOME }}/.ssh/known_hosts
    sshpass -e ssh-copy-id {{ ansible_env.USER }}@{{ inventory_hostname }}
